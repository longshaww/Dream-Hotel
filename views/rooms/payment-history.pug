extends ../layouts/general
block append head 
    script(src="https://unpkg.com/xlsx/dist/xlsx.full.min.js")

block content
    h1 Payment History 
    form(action="/rooms/payment-history/search",method="GET" )
        .row 
            .col
                select.form-select(name="q" aria-label='Default select example')
                    option(selected='' value="") Select a month
                    option(value='1') January
                    option(value='2') February
                    option(value='3') March
                    option(value='4') April
                    option(value='5') May
                    option(value='6') June
                    option(value='7') July
                    option(value='8') August
                    option(value='9') September
                    option(value='10') October
                    option(value='11') November
                    option(value='12') December
            .col
                button.btn.btn-dark(type="submit") Search

    .table-responsive 
        table.table#report-table 
            thead 
                tr
                    th.col Tên
                    th.col Phone
                    th.col CMND
                    th.col Phòng
                    th.col Ngày thuê
                    th.col Số ngày ở
                    th.col Giá phòng/Ngày
                    th.col Ngày thanh toán 
                    th.col Tổng
            tbody
                each payment in payments
                    tr 
                        if(payment.customer)
                            td=payment.customer.name 
                            td=payment.customer.phone 
                            td=payment.customer.CMND 
                            td=payment.room.room_id 
                            td=payment.customer.checkin_date+"-"+payment.customer.checkout_date 
                            td=payment.days_rent
                            td=payment.room.price 
                            td=payment.pay_date
                            td#price=payment.summary
                break
                    tr
                        td.fw-bold Tổng
                        td#get-total
    .row 
        .col.text-center.pt-4
            button#total-btn.btn.btn-dark(href="") Tính tổng
            button#export-btn.btn.btn-dark.ms-2(onclick="ExportToExcel('xlsx', 'ReportTable')") Xuất excel
            
    script.
        var arr = [];
        var reportTable = document.querySelector("#report-table");
        // var exportBtn = document.querySelector("#export-btn");
        var totalBtn = document.querySelector("#total-btn");
        var getTotal = document.querySelector("#get-total");
        var prices = document.querySelectorAll("#price");
        prices.forEach(function (price) {
            arr.push(parseInt(price.innerHTML.slice(1)));
        });
        var total = arr.reduce(function (a, b) {
            return a + b;
        }, 0);

        totalBtn.addEventListener("click", function () {
            getTotal.innerHTML = total;
        });
        // exportBtn.addEventListner("click", ExportToExcel("xlsx", "ReportTable"));
        function ExportToExcel(fileExtension, fileName) {
            var wb = XLSX.utils.table_to_book(reportTable, { sheet: "sheet1" });
            return XLSX.writeFile(
                wb,
                fileName + "." + fileExtension ||
                    "MySheetName." + (fileExtension || "xlsx")
            );
        }
